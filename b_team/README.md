## 데이터 전처리

수집 데이터 : 국가법령정보센터의 사회복지 분야의 법령 문서
데이터 수집 방식 : 크롤링을 통해 txt 파일로 통합함.
전처리 방식 :  law_data.replace 를 통해 크롤링할 때 함께 긁혀온 필요없는 글자들 삭제( 연혁, 한눈 보기...)
비슷한 형식의 구조의 문장들이라 띄어쓰기와 줄바꿈을 기준으로 나눔.

---

## 1. 사용 모델

### 답변 llm : LGAI-EXAONE/EXAONE-3.5-2.4B-Instruct

* 사용이유: 법령 자체가 한국어이기 때문에 한글에 특화되면서 한국의 모델을 사용해보고 싶어서
* 1.사용이슈 : vscode에서 실행시 2.4B 모델도 cpu로 테스트하면 속도가 매우 느려 답변을 받을 수가 없습니다.
* 2.사용이슈 : 법령 전처리를 법령 별로 하여서 data 차이가 커서
  만약 법령 내용이 많은 답변을 가져와야 할 경우 엑사원의 최대 토큰 까지만 가져오게되어 내용이 잘리게 됩니다.
* 3.사용이슈: 엑사원을 허깅페이스로 다운받아서 사용해서 HuggingFacePipeline이라는
  허깅페이스 모델을 LLM 객체로 변환해주는 langchain 인터페이스를 사용하였습니다.

### embedding : woong0322/ko-legal-sbert-finetuned

* 사용이유 : 한국어 법률 도메인에 특화되어 있어서
* 1.사용이슈 : runpod에서 hugginface로 다운로드 받는 경우 hf_transfer라는
  다운로드 부스터 라이브러리를 사용하게 되서 설치를 해줘야 합니다.

### 평가 llm : gpt-4o-mini

* 사용이유 : mini로 사용한 이유는 엑사원을 사용하면서 답변 자체가 느려
  조금이라도 빠른 속도로 평가를 받아보고 싶어서

### 평가 embedding : text-embedding-3-small

* 사용이유 : 평가 llm처럼 small은 쓴 이유는 동일합니다.

### 실행 서버 : runpod

* 사용이유: vscode 에서 huggingface로 답변 llm과 embedding을 다운받아서 prompt로 답변을 받으려고 하니
  10분이 지나도 답변을 주지 않을 만큼 속도가 느려서 답변을 받을 수가 없어서 runpod의 gpu로 실행하기로 하였습니다.

---

## 2. qdrant

runpod 이라는 외부 서버를 사용하기 때문에 docker를 사용하지 않고
qdrant 바이너리를 runpod에 설치해서 직접 사용하였습니다.

data는 디렉토리를 만들어서 사용하기 때문에 qdrant를 실행할 경우
storage path를 생성한 디렉토리로 지정해준 다음 실행하여야 합니다.

---

## 3. fastapi

runpod에서 허깅페이스 모델 속도를 줄이기 위해 py 파일을 실행할때 fastapi로 실행하게 하였습니다.

---

## 4. 성능평가

ragas 성능평가 지표중 faithfulness,answer_relevancy 를 사용하고 있습니다.

최초 baseline 프롬프트로 실행시에는 평가 llm이 user_input을 제대로 처리하지 못해서
faithfulness 차이가 컸고 실제 답변도 질문과 맞지 않았으나

프롬프트를 보완한 후에는 실제 답변은 질문과 맞게 나오지만 faithfulness차이는 해결하지 못하였습니다.

---

## 5. 프롬프트 수정 과정

### 해당 내용에 대한 답변

: 무엇이든지 법령과 연관 지어서 답변

#### ex)

나:  오늘 저녁은 뭐 먹을까?
Assistant: 오늘 저녁 메뉴를 결정하실 때 참고하실 수 있는 몇 가지 법령 정보를 알려드릴게요.

* **노인ᆞ장애인 등 사회복지시설의 급식안전 지원에 관한 법률** (약칭: 사회복지시설급식법)은 취약계층인 노인, 장애인 등이 거주하거나 이용하는 사회복지시설에서 제공하는 단체급식의 위생과 영양 관리를 지원하기 위한 법률입니다.

*LLM의 질문 분석 과정에서 수정해야 할 부분이라 프롬프트만으로는 고칠 수 없다는 것을 확인함.
*사회복지 관련 업무와 관련된 질문만 묻는 것으로 상정하고 테스트 시작.

### *할루시네이션*

#### ex)

나:  사회복지사의 자격박탈 사유를 알려줘
Assistant: 사회복지사의 자격박탈 사유는 주로 다음과 같은 법령과 규정에 근거하여 결정됩니다:
**[사회복지사업법 제35조]**
**법령 위반**:

* **제35조 제1항**에 따르면, 사회복지사가 다음과 같은 행위를 할 경우 자격이 박탈될 수 있습니다:

*실제 사회복지사업법 제 35조는 시설의 장은 상근(常勤)하여야 한다. 이며 35조 자체는 사회복지사의 자격박탈과 관련도가 낮은 사회복지 시설의 장의 자격 조건에 관련된 내용이 나옴.

*프롬프트의 수정을 통해서 비슷한 내용이 담겨있는 법령을 부르도록 설정함.
*답변에서 크게 할루시네이션이 줄어든 것을 확인했음.
